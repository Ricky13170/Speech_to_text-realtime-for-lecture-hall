<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>ASR Overlay</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: transparent;
    font-family: "Segoe UI", "Roboto", sans-serif;
  }

  #subtitle {
    position: fixed;
    bottom: 6%;
    left: 50%;
    transform: translateX(-50%);
    color: #ffffff;
    font-size: 2rem;
    font-weight: 600;
    text-align: center;
    text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.9);
    width: 90%;
    transition: opacity 0.3s ease-in-out;
  }

  #subtitle.final {
    color: #00ff77;
  }

  #subtitle.realtime {
    color: #ffe600;
  }
</style>
</head>
<body>
  <div id="subtitle">‚è≥ ƒêang kh·ªüi ƒë·ªông...</div>

  <script>
    // üîå K·∫øt n·ªëi ƒë√∫ng WebSocket server c·ªßa b·∫°n
    const SERVER_WS = "ws://127.0.0.1:8012/ws";
    const socket = new WebSocket(SERVER_WS);

    const subtitle = document.getElementById("subtitle");
    let fadeTimeout = null;

    socket.onopen = () => {
      console.log("‚úÖ ƒê√£ k·∫øt n·ªëi t·ªõi ASR server:", SERVER_WS);
      subtitle.textContent = "üéôÔ∏è Listening...";
      subtitle.className = "realtime";
    };

    socket.onmessage = (event) => {
      const msg = JSON.parse(event.data);
      if (!msg.type || !msg.text) return;

      if (msg.type === "realtime") {
        subtitle.textContent = msg.text;
        subtitle.className = "realtime";
        subtitle.style.opacity = 1;
        clearTimeout(fadeTimeout);
      }

      if (msg.type === "fullSentence") {
        subtitle.textContent = msg.text;
        subtitle.className = "final";
        subtitle.style.opacity = 1;

        // ·∫®n d·∫ßn sau v√†i gi√¢y
        clearTimeout(fadeTimeout);
        fadeTimeout = setTimeout(() => {
          subtitle.style.opacity = 0;
        }, 4000);
      }
    };

    socket.onerror = (err) => {
      console.error("‚ùå L·ªói WebSocket:", err);
      subtitle.textContent = "‚ùå Kh√¥ng k·∫øt n·ªëi ƒë∆∞·ª£c server.";
      subtitle.className = "final";
    };

    socket.onclose = () => {
      console.log("‚ö†Ô∏è WebSocket ƒë√≥ng k·∫øt n·ªëi.");
      subtitle.textContent = "üîå M·∫•t k·∫øt n·ªëi ASR server.";
      subtitle.className = "final";
    };
  </script>
</body>
</html>
